#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed Aug 19 11:48:55 2020

@author: christophboomer
"""

import pandas
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import btalib

from plotly.offline import plot
import plotly.graph_objs as go
from plotly.subplots import make_subplots

from scipy.signal import find_peaks



csvName='historicalData300ETHBTC'
df = pd.read_csv(csvName+'.csv', index_col=0, header=[0,1])
df.columns=df.columns.droplevel()
print(df.dtypes)
print(type(df.index))

#plot(fig)
#print(btalib.mfi(df).df)
'''
df['mfi']=btalib.mfi(df).df
df['sma']=btalib.sma(df).df
df['wma']=btalib.wma(df).df
df['mom']=btalib.mom(df).df
#df['rsi']=btalib.rsi(df).df
df['cci']=btalib.cci(df).df
'''
print(df.index)





'''
df['trading']=0
# Sell = 0
# Buy = 1
l_new=[]
for el in l:
      if el[1]=='Buy':
            el[1]=1
      if el[1]=='Sell':
            el[1]=0
      l_new.append(el)
print(l_new)
l_new=np.asarray(l_new,dtype=np.int)
print(l_new)
status=0
#print(l_new[np.where(l_new==1504313100 )[0],:][0,1])
for ind in df.index:
      if np.isin(ind,l_new):
            #print(l_new[np.where(l_new==ind),:])
            status = l_new[np.where(l_new==ind )[0],:][0,1]
      df.loc[ind,'trading']= status
print(df)
'''
#df.to_csv(csvName+'.csv')
period=300
df=df.loc[df.index[:50000],:]
peakIndices=find_peaks(df.close,prominence=0.00004,width=2)
valleyIndices= find_peaks(-df.close,prominence=0.00004,width=2)
index=np.array(df.index)
peakIndex=index[peakIndices[0]]
valleyIndex=index[valleyIndices[0]]

df['trading']=0
# Sell = 0
# Buy = 1
l_new=[]
for el in l:
      if el[1]=='Buy':
            el[1]=1
      if el[1]=='Sell':
            el[1]=0
      l_new.append(el)
print(l_new)
l_new=np.asarray(l_new,dtype=np.int)
print(l_new)
status=0
#print(l_new[np.where(l_new==1504313100 )[0],:][0,1])
for ind in df.index:
      if np.isin(ind,l_new):
            #print(l_new[np.where(l_new==ind),:])
            status = l_new[np.where(l_new==ind )[0],:][0,1]
      df.loc[ind,'trading']= status
print(df)

print('peakindex:',peakIndex)
print('valleyindex:',valleyIndex)
print(df.loc[peakIndex,'close'])

fig= make_subplots(rows=1, cols=1)
fig.update_layout(
    xaxis=dict(
                tickformat='.0',
                showgrid=False)
)
#df.index = df.index.astype(int)

fig.add_trace(go.Scatter(
                x=df.index,
                y=df.close,
                mode='lines',
                name='Test',
            ),
            row=1, col=1
)


fig.add_trace(go.Scatter(
                x=peakIndex,
                y=df.loc[peakIndex,'close'],
                mode='markers',
                name='Test',
                marker= dict(
                      size=5,
                      color='green'

                )
            ),
            row=1, col=1
)
fig.add_trace(go.Scatter(
                x=valleyIndex,
                y=df.loc[valleyIndex,'close'],
                mode='markers',
                name='Test',
                marker= dict(
                      size=5,
                      color='red'

                )
            ),
            row=1, col=1
)
plot(fig)




l=[[1504313100,'Sell'],[1504512000,'Buy'],[1504791600,'Sell'],[1509597900,'Buy'],[1510239900,'Sell'],[1513128600,'Buy'],[1515273300,'Sell'],\
      [1515384600,'Buy'],[1515467100,'Sell'],[1515570900,'Buy'],[1515729300,'Sell'],[1515944100,'Buy'],[1516002000,'Sell'],[1516097100,'Buy'],\
      [1516242000,'Sell'],[1517575500,'Buy'],[1517589900,'Sell'],[1517899500,'Buy'],[1518232394,'Sell'],[1519172400,'Buy'],[1519716600,'Sell'],\
      [1520862900,'Buy'],[1520952000,'Sell'],[1521581700,'Buy'],[1521918600,'Buy'],[1522086300,'Buy'],[1522771200,'Sell'],[1524292200,'Buy'],\
      [1524591900,'Sell'],[1525702200,'Buy'],[1525918500,'Sell'],[1526510100,'Buy'],[1526646600,'Sell'],[1526833800,'Buy'],[1526985900,'Sell'],\
      [1527067500,'Buy'],[1527218100,'Sell'],[1527546300,'Buy'],[1527962400,'Sell'],[1528122000,'Buy'],[1528282500,'Sell'],[1528666200,'Buy'],\
      [1528865700,'Sell'],[1528975500,'Buy'],[1529315400,'Sell'],[1529507100,'Buy'],[1529754300,'Sell'],[1532434200,'Buy'],[1533429600,'Sell'],\
      [1534211700,'Buy'],[1534554300,'Sell'],[1535100000,'Buy'],[1535391000,'Buy'],[1536782700,'Buy'],[1537048200,'Sell'],[1538484600,'Buy'],\
      [1538758200,'Sell'],[1543432500,'Buy'],[1544012700,'Sell'],[1544204700,'Buy'],[1548576000,'Sell'],[1548933300,'Buy'],[1549935900,'Sell'],\
      [1550155500,'Buy'],[1550220000,'Sell'],[1550507700,'Buy'],[1550653200,'Sell'],[1550739900,'Buy'],[1550818800,'Sell'],[1550989200,'Buy'],\
      [1551044100,'Sell'],[1551234900,'Buy'],[1551932700,'Sell'],[1552067100,'Buy'],[1552104000,'Sell'],[1552236600,'Buy'],[1552432800,'Sell'],\
      [1552712700,'Buy'],[1552769700,'Sell'],[1553179800,'Buy'],[1553433600,'Sell'],[1553917500,'Buy'],[1554117600,'Sell'],[1554182700,'Buy'],\
      [1554234900,'Sell'],[1554327000,'Buy'],[1554408300,'Sell'],[1554786900,'Buy'],[1554814800,'Sell'],[1554982200,'Buy'],[1555272600,'Sell'],\
      [1555560000,'Buy'],[1555688400,'Sell'],[1555709100,'Buy'],[1555743900,'Sell'],[1555840800,'Buy'],[1555864800,'Sell'],[1555902900,'Buy'],\
      [1555928700,'Sell'],[1556091900,'Buy'],[1556167500,'Sell'],[1556229000,'Buy'],[1556251500,'Sell'],[1556406900,'Buy'],[1556444700,'Sell'],\
      [1556787300,'Buy'],[1556807400,'Sell'],[1557555600,'Buy'],[1557590700,'Sell'],[1557654000,'Buy'],[1557733200,'Sell'],[1557767400,'Buy'],\
      [1557796500,'Sell'],[1557846300,'Buy'],[1557925800,'Sell'],[1557951900,'Buy'],[1557979200,'Sell'],[1558008600,'Buy'],[1558088400,'Sell'],\
      [1558113000,'Buy'],[1558223400,'Sell'],[1558307400,'Buy'],[1558359600,'Sell'],[1558430400,'Buy'],[1558455000,'Sell'],[1558661700,'Buy'],\
      [1558775100,'Sell'],[1559108700,'Buy'],[1559185500,'Sell'],[1559298600,'Buy'],[1559363700,'Sell'],[1559534100,'Buy'],[1559655600,'Sell'],\
      [1559715000,'Buy'],[1559783100,'Sell'],[1560225600,'Buy'],[1560410400,'Sell'],[1560528600,'Buy'],[1560591000,'Sell'],[1560694200,'Buy'],\
      [1560957600,'Sell'],[1561008900,'Buy'],[1561032900,'Sell'],[1561252500,'Buy'],[1561287300,'Sell'],[1561325700,'Buy'],[1561335600,'Sell'],\
      [1561578900,'Buy'],[1561654800,'Sell'],[1561771800,'Buy'],[1561830000,'Sell'],[1561931700,'Buy'],[1562044200,'Sell'],[1562198400,'Buy'],\
      [1562309400,'Sell'],[1562737800,'Buy'],[1562818200,'Sell'],[1562860800,'Buy'],[1562901000,'Sell'],[1563232500,'Buy'],[1563378000,'Sell'],\
      [1563398700,'Buy'],[1563409500,'Sell'],[1563426600,'Buy'],[1563451500,'Sell'],[1563469500,'Buy'],[1563527700,'Sell'],[1563570300,'Buy'],\
      [1563588900,'Sell'],[1563714600,'Buy'],[1563792900,'Sell'],[1563798900,'Buy'],[1563822600,'Sell'],[1563951000,'Buy'],[1563985200,'Sell'],\
      [1564018500,'Buy'],[1564181700,'Sell'],[1564619700,'Buy'],[1564652400,'Sell'],[1565076300,'Buy'],[1565131200,'Sell'],[1565179500,'Buy'],\
      [1565196000,'Sell'],[1565223300,'Buy'],[1565254500,'Sell'],[1565272500,'Buy'],[1565298900,'Sell'],[1565308800,'Buy'],[1565318400,'Sell'],\
      [1565355600,'Buy'],[1565358000,'Sell'],[1565421000,'Buy'],[1565776500,'Sell'],[1565802600,'Buy'],[1565880000,'Sell'],[1565976000,'Buy'],\
      [1566197400,'Sell'],[1566350100,'Buy'],[1566384000,'Sell'],[1566404700,'Buy'],[1566433200,'Sell'],[1566778500,'Buy'],[1566810300,'Sell'],\
      [1566875100,'Buy'],[1566955200,'Sell'],[1567414200,'Buy'],[1567433100,'Sell'],[1567690500,'Buy'],[1567708800,'Sell'],[1567750800,'Buy'],\
      [1567765200,'Sell'],[1567772700,'Buy'],[1567808400,'Sell'],[1568270700,'Buy'],[1568281800,'Sell'],[1568701800,'Buy'],[1568806200,'Sell'],\
      [1569413700,'Buy'],[1569502800,'Sell'],[1569760800,'Buy'],[1570620300,'Sell'],[1570644000,'Buy'],[1570657500,'Sell'],[1570780800,'Buy'],\
      [1571013600,'Sell'],[1571041500,'Buy'],[1571132100,'Sell'],[1571234400,'Buy'],[1571328000,'Sell'],[1571641200,'Buy'],[1571732700,'Sell'],\
      [1571921100,'Buy'],[1572005400,'Sell'],[1572054000,'Buy'],[1572158400,'Sell'],[1572175500,'Buy'],[1572232800,'Sell'],[1572244500,'Buy'],\
      [1572250200,'Sell'],[1572270300,'Buy'],[1572327900,'Sell'],[1572443100,'Buy'],[1572482100,'Sell'],[1572524100,'Buy'],[1572835800,'Sell'],\
      [1572899100,'Buy'],[1573380000,'Sell'],[1573426800,'Buy'],[1573638000,'Sell'],[1574348100,'Buy'],[1574392500,'Sell'],[1574433600,'Buy'],\
      [1574468400,'Sell'],[1574501100,'Buy'],[1574577600,'Sell'],[1574729400,'Buy'],[1574736300,'Sell'],[1575465600,'Buy'],[1575593700,'Sell'],\
      [1576614900,'Buy'],[1576666200,'Sell'],[1577117400,'Buy'],[1577677200,'Sell'],[1578070500,'Buy'],[1578308400,'Sell'],[1578502800,'Sell'],\
      [1578803400,'Sell'],[1578974700,'Buy'],[1579025400,'Sell'],[1579047300,'Buy'],[1579057200,'Sell'],[1579075200,'Buy'],[1579085400,'Sell'],\
      [1579167300,'Buy'],[1579234500,'Sell'],[1579263900,'Buy'],[1579301400,'Sell'],[1579329000,'Buy'],[1579358700,'Sell'],[1579436400,'Buy'],\
      [1579658700,'Sell'],[1579834800,'Buy'],[1579875000,'Sell'],[1579916700,'Buy'],[1579945200,'Sell'],[1580355000,'Buy'],[1580443200,'Sell'],\
      [1580484000,'Buy'],[1580870700,'Sell'],[1580936700,'Buy'],[1581072900,'Sell'],[1581124200,'Buy'],[1581152700,'Sell'],[1581184800,'Buy'],\
      [1581220500,'Sell'],[1581256200,'Buy'],[1581322800,'Sell'],[1581437400,'Buy'],[1581555300,'Sell'],[1581594000,'Buy'],[1581766200,'Sell'],\
      [1581810300,'Buy'],[1581821400,'Sell'],[1581871500,'Buy'],[1581878700,'Sell'],[1581912600,'Buy'],[1581920100,'Sell'],[1581938400,'Buy'],\
      [1581998700,'Sell'],[1582216500,'Buy'],[1582256400,'Sell'],[1582360200,'Buy'],[1582508100,'Sell'],[1582733700,'Buy'],[1582853700,'Sell'],\
      [1582883400,'Buy'],[1582938300,'Sell'],[1582970400,'Buy'],[1582975800,'Sell'],[1583093700,'Buy'],[1583234400,'Sell'],[1583259900,'Buy'],\
      [1583403300,'Sell'],[1583451300,'Buy'],[1583491500,'Sell'],[1583768400,'Buy'],[1583879700,'Sell'],[1584011700,'Buy'],[1584059400,'Sell'],\
      [1584071100,'Buy'],[1584089700,'Sell'],[1584098100,'Buy'],[1584110400,'Sell'],[1584113700,'Buy'],[1584117600,'Sell'],[1584125100,'Buy'],\
      [1584159000,'Sell'],[1584394800,'Buy'],[1584664500,'Sell'],[1584735900,'Buy'],[1584835200,'Sell'],[1585128900,'Buy'],[1585267200,'Sell'],\
      [1585608300,'Buy'],[1585711800,'Sell'],[1585850700,'Buy'],[1585991700,'Sell'],[1585995000,'Buy'],[1586015100,'Sell'],[1586158500,'Buy'],\
      [1586196600,'Sell'],[1586289300,'Buy'],[1586317500,'Sell'],[1586641800,'Buy'],[1586776500,'Sell'],[1586786400,'Buy'],[1586870700,'Sell'],\
      [1586996400,'Buy'],[1587019800,'Sell'],[1587101100,'Buy'],[1587249900,'Sell'],[1588237200,'Buy'],[1588307100,'Sell'],[1588951500,'Buy'],\
      [1589009100,'Sell'],[1589199900,'Buy'],[1589292300,'Sell'],[1589765400,'Buy'],[1590419400,'Sell'],[1590675300,'Buy'],[1590890100,'Sell'],\
      [1591054800,'Buy'],[1591186800,'Sell'],[1591300500,'Buy'],[1591407600,'Sell'],[1593309300,'Buy'],[1594201500,'Sell'],[1594309200,'Buy'],\
      [1504550700,'Sell'],[1594606200,'Buy'],[1594647300,'Sell'],[1594893900,'Buy'],[1594971300,'Sell'],[1595133000,'Buy'],[1595153400,'Sell'],\
      [1595174100,'Buy'],[1595214600,'Sell'],[1595457000,'Buy'],[1595550300,'Sell'],[1595572800,'Buy'],[1595663100,'Sell'],[1595888100,'Buy'],\
      [1595962500,'Sell'],[1596042000,'Buy'],[1596172200,'Sell'],[1596344100,'Buy'],[1596454800,'Sell'],[1596567300,'Buy'],[1596600000,'Sell'],\
      [1596882300,'Buy'],[1596940200,'Sell'],[1597210500,'Buy'],[1597221000,'Sell'],[1597394700,'Buy'],[1597416900,'Sell'],[1597527300,'Buy'],\
      [1597604100,'Sell'],[1597679100,'Buy'],[1597701000,'Sell'],[1597761000,'Buy'],[1597771500,'Sell'],[1597868100,'Buy'],[1597929300,'Sell']]













